<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>NA • thonk</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="NA"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">thonk</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/simonpcouch/thonk/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>NA</h1>
      <small class="dont-index">Source: <a href="https://github.com/simonpcouch/thonk/blob/main/CLAUDE.md" class="external-link"><code>CLAUDE.md</code></a></small>
    </div>


<p>You are situated inside of an R package source directory. The subdirectory <code>R/</code> contains source files. The subdirectory <code>tests/testthat/</code> contains corresponding tests. e.g. <code>R/thonk.R</code> is tested primarily in <code>tests/testthat/test-thonk.R</code>.</p>
<p>Do not add new code comments, and only remove existing code comments if the comment isn’t relevant anymore.</p>
<p>The package has not yet been published and does not have any users; remove functionality outright when it’s no longer needed rather than beginning a deprecation process. No need to worry about breaking changes.</p>
<p>When testing code that raises a message, warning, or error, use <code>expect_snapshot()</code> (possibly with <code>error = TRUE</code>) instead of <code>expect_message()</code> or otherwise.</p>
<p>When you’re running package tests, use <code>devtools::load_all(); testthat::test_file("tests/testthat/path-to-file.R")</code>. If you encounter namespacing issues, don’t delete tests that otherwise should work, and instead ask me what to do.</p>
<p>Code that I’ve written previously for a different package that you should model is in <code>inst/context/</code>.</p>
<div class="section level2">
<h2 id="context---btw">Context - btw<a class="anchor" aria-label="anchor" href="#context---btw"></a></h2>
<p><code>?</code>(ellmer::Chat)</p>
<p>Chat package:ellmer R Documentation</p>
<p>A chat</p>
<p>Description:</p>
<pre><code> A ‘Chat’ is an sequence of sequence of user and assistant Turns
 sent to a specific Provider. A ‘Chat’ is a mutable R6 object that
 takes care of managing the state associated with the chat; i.e. it
 records the messages that you send to the server, and the messages
 that you receive back. If you register a tool (i.e. an R function
 that the assistant can call on your behalf), it also takes care of
 the tool loop.

 You should generally not create this object yourself, but instead
 call ‘chat_openai()’ or friends instead.</code></pre>
<p>Value:</p>
<pre><code> A Chat object</code></pre>
<p>Methods:</p>
<p>Public methods:</p>
<pre><code>     • ‘Chat$new()’

     • ‘Chat$get_turns()’

     • ‘Chat$set_turns()’

     • ‘Chat$add_turn()’

     • ‘Chat$get_system_prompt()’

     • ‘Chat$get_model()’

     • ‘Chat$set_system_prompt()’

     • ‘Chat$tokens()’

     • ‘Chat$last_turn()’

     • ‘Chat$chat()’

     • ‘Chat$chat_parallel()’

     • ‘Chat$extract_data()’

     • ‘Chat$extract_data_parallel()’

     • ‘Chat$extract_data_async()’

     • ‘Chat$chat_async()’

     • ‘Chat$stream()’

     • ‘Chat$stream_async()’

     • ‘Chat$register_tool()’

     • ‘Chat$clone()’</code></pre>
<p>Method ‘new()’:</p>
<pre><code>Usage:

     Chat$new(provider, turns, seed = NULL, echo = "none")

Arguments:

     ‘provider’ A provider object.

     ‘turns’ An unnamed list of turns to start the chat with (i.e.,
         continuing a previous conversation). If ‘NULL’ or
         zero-length list, the conversation begins from scratch.

     ‘seed’ Optional integer seed that ChatGPT uses to try and make
         output more reproducible.

     ‘echo’ One of the following options:

           • ‘none’: don't emit any output (default when running in
             a function).

           • ‘text’: echo text output as it streams in (default
             when running at the console).

           • ‘all’: echo all input and output.

         Note this only affects the ‘chat()’ method.</code></pre>
<p>Method ‘get_turns()’:</p>
<pre><code>   Retrieve the turns that have been sent and received so far
   (optionally starting with the system prompt, if any).

Usage:

     Chat$get_turns(include_system_prompt = FALSE)


Arguments:

     ‘include_system_prompt’ Whether to include the system prompt
         in the turns (if any exists).</code></pre>
<p>Method ‘set_turns()’:</p>
<pre><code>   Replace existing turns with a new list.

Usage:

     Chat$set_turns(value)


Arguments:

     ‘value’ A list of Turns.</code></pre>
<p>Method ‘add_turn()’:</p>
<pre><code>   Add a pair of turns to the chat.

Usage:

     Chat$add_turn(user, system)


Arguments:

     ‘user’ The user Turn.

     ‘system’ The system Turn.</code></pre>
<p>Method ‘get_system_prompt()’:</p>
<pre><code>   If set, the system prompt, it not, ‘NULL’.

Usage:

     Chat$get_system_prompt()
     </code></pre>
<p>Method ‘get_model()’:</p>
<pre><code>   Retrieve the model name

Usage:

     Chat$get_model()
     </code></pre>
<p>Method ‘set_system_prompt()’:</p>
<pre><code>   Update the system prompt

Usage:

     Chat$set_system_prompt(value)


Arguments:

     ‘value’ A string giving the new system prompt</code></pre>
<p>Method ‘tokens()’:</p>
<pre><code>   List the number of tokens consumed by each assistant turn.
   Currently tokens are recorded for assistant turns only; so user
   turns will have zeros.

Usage:

     Chat$tokens()
     </code></pre>
<p>Method ‘last_turn()’:</p>
<pre><code>   The last turn returned by the assistant.

Usage:

     Chat$last_turn(role = c("assistant", "user", "system"))


Arguments:

     ‘role’ Optionally, specify a role to find the last turn with
         for the role.


Returns:

     Either a ‘Turn’ or ‘NULL’, if no turns with the specified role
     have occurred.</code></pre>
<p>Method ‘chat()’:</p>
<pre><code>   Submit input to the chatbot, and return the response as a simple
   string (probably Markdown).

Usage:

     Chat$chat(..., echo = NULL)


Arguments:

     ‘...’ The input to send to the chatbot. Can be strings or
         images (see ‘content_image_file()’ and
         ‘content_image_url()’.

     ‘echo’ Whether to emit the response to stdout as it is
         received. If ‘NULL’, then the value of ‘echo’ set when the
         chat object was created will be used.</code></pre>
<p>Method ‘chat_parallel()’:</p>
<pre><code>   *[Experimental]*

   Submit multiple prompts in parallel. Returns a list of Chat
   objects, one for each prompt.

Usage:

     Chat$chat_parallel(prompts, max_active = 10, rpm = 500)


Arguments:

     ‘prompts’ A list of user prompts.

     ‘max_active’ The maximum number of simultaenous requests to
         send.

     ‘rpm’ Maximum number of requests per minute.</code></pre>
<p>Method ‘extract_data()’:</p>
<pre><code>   Extract structured data

Usage:

     Chat$extract_data(..., type, echo = "none", convert = TRUE)


Arguments:

     ‘...’ The input to send to the chatbot. Will typically include
         the phrase "extract structured data".

     ‘type’ A type specification for the extracted data. Should be
         created with a ‘type_()’ function.

     ‘echo’ Whether to emit the response to stdout as it is
         received. Set to "text" to stream JSON data as it's
         generated (not supported by all providers).

     ‘convert’ Automatically convert from JSON lists to R data
         types using the schema. For example, this will turn arrays
         of objects into data frames and arrays of strings into a
         character vector.</code></pre>
<p>Method ‘extract_data_parallel()’:</p>
<pre><code>   *[Experimental]*

   Submit multiple prompts in parallel. Returns a list of extracted
   data, one for each prompt.

Usage:

     Chat$extract_data_parallel(
       prompts,
       type,
       convert = TRUE,
       max_active = 10,
       rpm = 500
     )


Arguments:

     ‘prompts’ A list of user prompts.

     ‘type’ A type specification for the extracted data. Should be
         created with a ‘type_()’ function.

     ‘convert’ Automatically convert from JSON lists to R data
         types using the schema. For example, this will turn arrays
         of objects into data frames and arrays of strings into a
         character vector.

     ‘max_active’ The maximum number of simultaenous requests to
         send.

     ‘rpm’ Maximum number of requests per minute.</code></pre>
<p>Method ‘extract_data_async()’:</p>
<pre><code>   Extract structured data, asynchronously. Returns a promise that
   resolves to an object matching the type specification.

Usage:

     Chat$extract_data_async(..., type, echo = "none")


Arguments:

     ‘...’ The input to send to the chatbot. Will typically include
         the phrase "extract structured data".

     ‘type’ A type specification for the extracted data. Should be
         created with a ‘type_()’ function.

     ‘echo’ Whether to emit the response to stdout as it is
         received. Set to "text" to stream JSON data as it's
         generated (not supported by all providers).</code></pre>
<p>Method ‘chat_async()’:</p>
<pre><code>   Submit input to the chatbot, and receive a promise that resolves
   with the response all at once. Returns a promise that resolves
   to a string (probably Markdown).

Usage:

     Chat$chat_async(...)


Arguments:

     ‘...’ The input to send to the chatbot. Can be strings or
         images.</code></pre>
<p>Method ‘stream()’:</p>
<pre><code>   Submit input to the chatbot, returning streaming results.
   Returns A coro generator that yields strings. While iterating,
   the generator will block while waiting for more content from the
   chatbot.

Usage:

     Chat$stream(...)


Arguments:

     ‘...’ The input to send to the chatbot. Can be strings or
         images.</code></pre>
<p>Method ‘stream_async()’:</p>
<pre><code>   Submit input to the chatbot, returning asynchronously streaming
   results. Returns a coro async generator that yields string
   promises.

Usage:

     Chat$stream_async(...)


Arguments:

     ‘...’ The input to send to the chatbot. Can be strings or
         images.</code></pre>
<p>Method ‘register_tool()’:</p>
<pre><code>   Register a tool (an R function) that the chatbot can use. If the
   chatbot decides to use the function, ellmer will automatically
   call it and submit the results back.

   The return value of the function. Generally, this should either
   be a string, or a JSON-serializable value. If you must have more
   direct control of the structure of the JSON that's returned, you
   can return a JSON-serializable value wrapped in ‘base::I()’,
   which ellmer will leave alone until the entire request is
   JSON-serialized.

Usage:

     Chat$register_tool(tool_def)


Arguments:

     ‘tool_def’ Tool definition created by ‘tool()’.</code></pre>
<p>Method ‘clone()’:</p>
<pre><code>   The objects of this class are cloneable with this method.

Usage:

     Chat$clone(deep = FALSE)


Arguments:

     ‘deep’ Whether to make a deep clone.</code></pre>
<p>Examples:</p>
<pre><code><span> <span class="va">chat</span> <span class="op">&lt;-</span> <span class="fu">chat_openai</span><span class="op">(</span>echo <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span> <span class="va">chat</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span><span class="st">"Tell me a funny joke"</span><span class="op">)</span></span>
<span> </span></code></pre>
</div>
<div class="section level2">
<h2 id="context---btw-1">Context - btw<a class="anchor" aria-label="anchor" href="#context---btw-1"></a></h2>
<p><code>?</code>(btw::btw) btw package:btw R Documentation</p>
<p>Plain-text descriptions of R objects</p>
<p>Description:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a> This <span class="cf">function</span> allows you to quickly describe your computational</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a> environment to a model by concatenating plain<span class="sc">-</span>text descriptions of</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a> <span class="st">"R stuff"</span>, from data frames to packages to <span class="cf">function</span> documentation.</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a> There are two key ways to use ‘<span class="fu">btw</span>()’<span class="sc">:</span></span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a>   <span class="fl">1.</span> Use it interactively at the console to gather information</span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a>      about your environment into prompt text that you can paste</span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a>      into the chat interface of an LLM, like ChatGPT or Claude. By</span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a>      default, ‘<span class="fu">btw</span>()’ copies the prompt to the clipboard <span class="cf">for</span> you.</span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" tabindex="-1"></a>      <span class="fu">btw</span>(<span class="fu">vignette</span>(<span class="st">"colwise"</span>, <span class="st">"dplyr"</span>), dplyr<span class="sc">::</span>across, dplyr<span class="sc">::</span>starwars)</span>
<span id="cb24-13"><a href="#cb24-13" tabindex="-1"></a>      <span class="co">#&gt; ✔ btw copied to the clipboard!</span></span>
<span id="cb24-14"><a href="#cb24-14" tabindex="-1"></a>      </span>
<span id="cb24-15"><a href="#cb24-15" tabindex="-1"></a>   <span class="fl">2.</span> Pair ‘<span class="fu">btw</span>()’ with ellmer<span class="sc">::</span>Chat during a chat session to</span>
<span id="cb24-16"><a href="#cb24-16" tabindex="-1"></a>      create a prompt that includes additional context drawn from</span>
<span id="cb24-17"><a href="#cb24-17" tabindex="-1"></a>      your environment and help pages.</span>
<span id="cb24-18"><a href="#cb24-18" tabindex="-1"></a></span>
<span id="cb24-19"><a href="#cb24-19" tabindex="-1"></a>      <span class="fu">library</span>(ellmer)</span>
<span id="cb24-20"><a href="#cb24-20" tabindex="-1"></a>      </span>
<span id="cb24-21"><a href="#cb24-21" tabindex="-1"></a>      chat <span class="ot">&lt;-</span> <span class="fu">chat_claude</span>() <span class="co"># requires an Anthropic API key</span></span>
<span id="cb24-22"><a href="#cb24-22" tabindex="-1"></a>      chat <span class="ot">&lt;-</span> <span class="fu">chat_ollama</span>(<span class="at">model =</span> <span class="st">"llama3.1:8b"</span>) <span class="co"># requires ollama and a local model</span></span>
<span id="cb24-23"><a href="#cb24-23" tabindex="-1"></a>      </span>
<span id="cb24-24"><a href="#cb24-24" tabindex="-1"></a>      chat<span class="sc">$</span><span class="fu">chat</span>(<span class="fu">btw</span>(</span>
<span id="cb24-25"><a href="#cb24-25" tabindex="-1"></a>        <span class="fu">vignette</span>(<span class="st">"colwise"</span>, <span class="st">"dplyr"</span>),</span>
<span id="cb24-26"><a href="#cb24-26" tabindex="-1"></a>        dplyr<span class="sc">::</span>across,</span>
<span id="cb24-27"><a href="#cb24-27" tabindex="-1"></a>        dplyr<span class="sc">::</span>starwars,</span>
<span id="cb24-28"><a href="#cb24-28" tabindex="-1"></a>        <span class="st">"Create a few interesting examples that use `dplyr::across()`"</span>,</span>
<span id="cb24-29"><a href="#cb24-29" tabindex="-1"></a>        <span class="st">"with the `starwars` data set."</span></span>
<span id="cb24-30"><a href="#cb24-30" tabindex="-1"></a>      ))</span>
<span id="cb24-31"><a href="#cb24-31" tabindex="-1"></a>      </span></code></pre></div>
<p>Usage:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a> <span class="fu">btw</span>(..., <span class="at">clipboard =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a> </span></code></pre></div>
<p>Arguments:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a> ...<span class="sc">:</span> Objects to describe from your R environment. You can pass</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>      objects themselves, like data frames or functions, or the</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>      <span class="cf">function</span> also accepts output from btw_tool_<span class="sc">*</span>() functions like</span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a>      ‘<span class="fu">btw_tool_get_package_help_topics</span>()’,</span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a>      ‘<span class="fu">btw_tool_get_help_page</span>()’, etc. If omitted, this <span class="cf">function</span></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>      will just describe the elements <span class="cf">in</span> your global R environment.</span></code></pre></div>
<p>clipboard: Whether to write the results to the clipboard. A single logical value; will default to ‘TRUE’ when run interactively.</p>
<p>Value:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a> Returns an ellmer<span class="sc">::</span>ContentText object with the collected prompt.</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a> If ‘clipboard <span class="ot">=</span> TRUE’, the prompt text is copied to the clipboard</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a> when the returned object is printed <span class="cf">for</span> the first <span class="fu">time</span> (e.g.</span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a> calling ‘<span class="fu">btw</span>()’ without assignment).</span></code></pre></div>
<p>Examples:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a> <span class="fu">btw</span>()</span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a> </span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a> <span class="fu">btw</span>(mtcars)</span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a> </span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a> <span class="fu">btw</span>(btw<span class="sc">::</span>btw)</span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a> </span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a> <span class="cf">if</span> (<span class="cn">FALSE</span>) {</span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a>   <span class="co"># btw() can also be used directly in {ellmer} chats</span></span>
<span id="cb28-9"><a href="#cb28-9" tabindex="-1"></a>   <span class="fu">library</span>(ellmer)</span>
<span id="cb28-10"><a href="#cb28-10" tabindex="-1"></a> </span>
<span id="cb28-11"><a href="#cb28-11" tabindex="-1"></a>   chat <span class="ot">&lt;-</span> <span class="fu">chat_ollama</span>(<span class="at">model =</span> <span class="st">"llama3.1:8b"</span>)</span>
<span id="cb28-12"><a href="#cb28-12" tabindex="-1"></a>   chat<span class="sc">$</span><span class="fu">chat</span>(</span>
<span id="cb28-13"><a href="#cb28-13" tabindex="-1"></a>     <span class="fu">btw</span>(mtcars, <span class="st">"Are there cars with 8 cylinders in this dataset?"</span>)</span>
<span id="cb28-14"><a href="#cb28-14" tabindex="-1"></a>   )</span>
<span id="cb28-15"><a href="#cb28-15" tabindex="-1"></a> }</span>
<span id="cb28-16"><a href="#cb28-16" tabindex="-1"></a> </span></code></pre></div>
</div>


  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Simon Couch, Posit Software, PBC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

